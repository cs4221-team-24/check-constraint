DROP TABLE IF EXISTS CUSTOMER;

CREATE TABLE CUSTOMER
(ID INT PRIMARY KEY, NAME VARCHAR(50), AGE INT, EMAIL VARCHAR(50), CITY VARCHAR(50), COUNTRY VARCHAR(50), CREDIT_LIMIT DECIMAL(10,2));

CREATE OR REPLACE FUNCTION CUSTOMER__check_function()
  RETURNS TRIGGER
  LANGUAGE PLPGSQL
  AS
  $$
  BEGIN
	  IF (NEW.AGE >= 18 AND NEW.AGE <= 100 ) AND (NEW.EMAIL LIKE '%@%.%' ) AND (NEW.CREDIT_LIMIT >= 0 ) AND (( NEW.CITY = 'New York' AND NEW.COUNTRY = 'USA' ) OR ( NEW.CITY = 'London' AND NEW.COUNTRY = 'UK' ) OR ( NEW.CITY = 'Paris' AND NEW.COUNTRY = 'France' ) ) THEN
		   return NEW;
	  END IF;
	  RETURN NULL;
  END;
  $$;

CREATE TRIGGER CUSTOMER__check_trigger
BEFORE INSERT ON CUSTOMER
  FOR EACH ROW EXECUTE FUNCTION CUSTOMER__check_function();
